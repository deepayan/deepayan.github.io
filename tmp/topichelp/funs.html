<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Help system links</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for does_not_matter {topichelp}"><tr><td>does_not_matter {topichelp}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Help system links</h2>

<h3>Description</h3>

<p>Examples of help system links that need to be handled carefully if we
change the current lookup order.
</p>


<h3>Usage</h3>

<pre>
fun1(x, ...)
fun2(x, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>An object.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>Extra arguments.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This file documents a proposed change to the lookup rule in R's
dynamic HTML help system, and identifies existing links on CRAN that
will need to be updated to continue working as intended. It is also
meant to serve as a source of test cases for the proposed change.
</p>
<p>The source of this documentation can be found at
<a href="https://github.com/deepayan/misc/blob/master/helptopic/man/funs.Rd">https://github.com/deepayan/misc/blob/master/helptopic/man/funs.Rd</a>
</p>


<h3>Current status</h3>

<p>The R help system includes a concept of hyperlinks to other help
pages. Such hyperlinks are supported to a limited extent in PDF (e.g.,
within-package links in the manual) and to a greater extent in HTML
help.
</p>
<p>For potential problems with within-package links, see
<code><a href="../../topichelp/help/fun3.html">fun3</a></code>.  This discussion is limited to links to
<em>other</em> packages. These come in two forms:
</p>

<ul>
<li> <p><code>\link[pkg:foo]{link-text}</code>, and
</p>
</li>
<li> <p><code>\link[pkg]{foo}</code> equivalent to <code>\link[pkg:foo]{foo}</code>
</p>
</li></ul>

<p>Here <code>pkg</code> is the target package, and <code>foo</code> has historically
been documented to be interpreted as a <em>file</em> link; i.e., both
links above are supposed to go to the file corresponding to
<code>pkg/man/foo.Rd</code>.  The explicit file specification is needed
because R manual pages often document multiple objects; e.g.,
<code>grid/man/grid.rect.Rd</code> documents both <code>grid.rect</code> and
<code>rectGrob</code>, so
</p>

<ul>
<li> <p><code>\link[grid]{grid.rect}</code> is fine:
<code><a href="../../grid/help/grid.rect.html">grid.rect</a></code> links to <code>grid.rect.html</code>,
</p>
</li>
<li> <p><code>\link[grid]{rectGrob}</code> will fail (for static HTML)
because the file <code>rectGrob.html</code> does not exist:
<code><a href="../../grid/help/rectGrob.html">rectGrob</a></code>,
</p>
</li>
<li> <p><code>\link[grid:rectGrob]{rectGrob}</code> will also fail (for
static HTML) because it is equivalent to the previous link:
<code><a href="../../grid/help/rectGrob.html">rectGrob</a></code>,
</p>
</li>
<li> <p><code>\link[grid:grid.rect]{rectGrob}</code> is fine:
<code><a href="../../grid/help/grid.rect.html">rectGrob</a></code> links to
<code>grid.rect.html</code>.
</p>
</li></ul>

<p>In R 2.10.0 or thereabouts, a new dynamic help system was introduced
to enable features not possible in static HTML files, such as the
ability to include content generated dynamically at the time of
rendering the page. This new system also modified the interpretation
for <code>\link[pkg:foo]{link-text}</code>:
</p>

<ul>
<li><p> If the file <code>pkg/man/foo.Rd</code> exists, it would link to
the corresponding HTML file <code>foo.html</code>.
</p>
</li>
<li><p> However, if this file <em>does not</em> exist, it would link to
the file containing the <em>topic</em> <code>foo</code> (i.e.,
<code>\alias{foo}</code>).
</p>
</li>
<li><p> However, the link URL continues to be of the form
<code>foo.html</code> in either case.
</p>
</li></ul>

<p>Note that this means that the link to be embedded in the HTML file
being rendered <em>does not</em> need to know anything about the target
package <span class="pkg">pkg</span>, and in particular, whether the link will at all be
resolved. The actual lookup will happen only when the user clicks on
the link, and may fail if the target package is not installed or the
file / topic does not exist in it.
</p>
<p>This also means that the links in the generated HTML is the same for
both static and dynamic help, but in the latter case a <code>foo.html</code>
link is resolved to <em>first</em> display the help page generated by
<code>man/foo.Rd</code> if it exists, and <em>then</em> to display the help
page generated by <code>man/bar.Rd</code> if <code>man/bar.Rd</code> contains
<code>\alias{foo}</code>.
</p>
<p>This can be verified by following the <span class="pkg">grid</span> links above and
checking the URL shown (through dynamic help).
</p>
<p>It is possible, in principle, for multiple help pages, say
<code>man/bar.Rd</code> and <code>man/baz.Rd</code>, to contain
<code>\alias{foo}</code>. Such packages can be installed (e.g., <code>fun1</code>
is an alias both in this page and in <code><a href="../../topichelp/help/fun3.html">fun3</a></code>), but <code>R
  CMD check</code> will produce a WARNING, so such packages will not get on
CRAN. Such a link will resolve to one of the two pages, but we do not
really care which one.
</p>


<h3>Fixing static pages</h3>

<p>In the current setup, one infelicity is that non-file links do not
work with static HTML pages. To solve this without changing the
generated HTML in any way, we must have a <code>topic.html</code> file
available for every topic (alias) in a package. This can be done
easily by creating small one-line HTTP redirect files pointing to the
actual target file while processing the package man files.
</p>
<p>To ensure that filenames get priority over topics, we only need to
ensure that
</p>

<ul>
<li><p> topic redirect files do not overwrite an existing (primary)
file of the same name
</p>
</li>
<li><p> primary files (<code>foo.Rd -&gt; foo.html</code>) <em>do</em> overwrite
existing (topic) files of the same name.
</p>
</li></ul>



<h3>Going further &mdash; prefer topic over filename</h3>

<p>Although file links are natural with traditional hyperlinks, for the R
help system it is more natural to link to topics rather than
filenames. There is a general consensus that we should move to a
system where <code>\link[pkg:foo]{link-text}</code> should be interpreted
as a link to the <em>topic</em> foo in package <span class="pkg">pkg</span>, regardless of
whether there is a file called <code>man/foo.Rd</code> in it. In fact, there
are many instances of packages on CRAN where this interpretation has
been assumed, because of the support for topic links in the dynamic
help system (such links do not currently work with static HTML).
</p>
<p>Implementing this should not be difficult, but unfortunately,
switching completely to a topic-only lookup rule would be unfair to
careful package authors who have intentionally linked to files. So the
proposal is only to <em>prefer</em> topics and fall back to files when
the topic does not exist.
</p>
<p>This still leaves open the possibility of penalizing careful package
authors under certain special circumstances; namely, the package
<span class="pkg">pkg</span> has a file <code>foo.Rd</code>, as well as a topic
<code>\alias{foo}</code> but in a <em>different</em> file <code>bar.Rd</code>. In
such cases, a link like <code>\link[pkg:foo]{link-text}</code> would change
meaning; from being a link to <code>foo.Rd</code> it will become a link to
<code>bar.Rd</code>.
</p>
<p>The example code below finds instances of such occurrences on CRAN
(yielding 79 such packages). Fortunately, in all these cases, the name
of the file (<code>bar.Rd</code>) is not an alias in the package (i.e.,
there is no <code>\alias{bar}</code>), so links of the form
<code>\link[pkg:bar]{link-text}</code> would unambiguously link to
<code>bar.Rd</code>.
</p>
<p>This is still not a problem unless there are <em>other</em> packages
that actually link to one of these ambiguous topic / file
pairs. Pattern matching leads to the following extant examples, which
we need to analyze. Fortunately, there are not many packages that
potentially need fixing, but we do need to find a resolution that will
work both in pre- and post-change versions of R.
</p>
<p>The examples are organized by target package.
</p>


<h3><span class="pkg">adegenet</span></h3>

<p>Topic <code>genind</code> is documented in file <code>new.genind.Rd</code>. File
<code>genind.Rd</code> documents <code>genind-class</code> and other related methods.
</p>
<p>Topic <code>genpop</code> is documented in file <code>new.genind.Rd</code>. File
<code>genpop.Rd</code> documents <code>genpop-class</code> and other related methods.
</p>
<p>The following packages link to either of these (<code>genind.Rd</code> and
<code>genpop.Rd</code>):
</p>

<ul>
<li><p> EcoGenetics/man/EcoGenetics-package.Rd: Conversion to and from
<a href="../../adegenet/help/genpop.html">genpop</a> is defined.
</p>
</li>
<li><p> pegas/man/conversion.Rd: <code><a href="../../adegenet/help/genind.html">genind</a></code>,
</p>
</li>
<li><p> poppr/man/make_haplotypes-method.Rd: <a href="../../adegenet/help/genind.html">genind</a> object.
</p>
</li>
<li><p> popprxl/man/read.genalexcel.Rd: <code><a href="../../adegenet/help/genind.html">genind</a></code>
</p>
</li>
<li><p> poppr/man/aboot.Rd: <code><a href="../../adegenet/help/genind.html">adegenet::genind()</a></code>
</p>
</li>
<li><p> poppr/man/aboot.Rd: <code><a href="../../adegenet/help/genpop.html">adegenet::genpop()</a></code>
with the specified strata.
</p>
</li></ul>

<p>All these currently link to the class page and not the function
page. This is probably as intended in several cases, although probably
not in at least the last two examples. Under the new proposal, these
will link to the function page.
</p>
<p>Links of the following form should work both under the current and
proposed rules:
</p>

<ul>
<li><p> For the <a href="../../adegenet/help/genind-class.html">class page</a>:
<code>\link[adegenet:genind-class]{link-text}</code>
</p>
</li>
<li><p> For the <a href="../../adegenet/help/new.genind.html">function page</a>:
<code>\link[adegenet:new.genind]{link-text}</code>
</p>
</li></ul>



<h3><span class="pkg">callr</span></h3>

<p>The following instances of <code>\link[callr:rcmd_safe]</code> both
currently link to the topic <code>rcmd_safe_env</code> in
<code>rcmd_safe.Rd</code>, which is likely not intended. The topic
<code>rcmd_safe</code> is documented in file <code>rcmd.Rd</code>.
</p>

<ul>
<li><p> fakemake/man/check_archive.Rd:
<code><a href="../../callr/help/rcmd_safe.html">callr::rcmd_safe</a>("check")</code>,
</p>
</li>
<li><p> pkgbuild/man/rcmd_build_tools.Rd: wrapper around
<code><a href="../../callr/help/rcmd_safe.html">callr::rcmd_safe()</a></code>
</p>
</li></ul>

<p>These will work as intended under the proposed scheme, so probably
best to leave them alone. Alternatively, change
<code><a href="../../callr/help/rcmd_safe.html">\link[callr:rcmd_safe]{link-text}</a></code> to
<code><a href="../../callr/help/rcmd.html">\link[callr:rcmd]{link-text}</a></code>.
</p>


<h3><span class="pkg">lamW</span></h3>

<p>The file <code>lamW.Rd</code> documents several functions, whereas the topic
<code>lamW</code> is documented in file <code>lamW-package.Rd</code>. So the
following links are all explicit and correct file links that will stop
working in the proposed scheme.
</p>

<ul>
<li><p> LambertW/man/W.Rd: <code><a href="../../lamW/help/lamW.html">lambertW0_C</a></code> and
</p>
</li>
<li><p> LambertW/man/W.Rd: <code><a href="../../lamW/help/lamW.html">lambertWm1_C</a></code> in
the <span class="pkg">lamW</span> package
</p>
</li>
<li><p> LambertW/man/W.Rd:<code>W</code> is a wrapper for
<code><a href="../../lamW/help/lamW.html">lambert_W0C</a></code>
</p>
</li>
<li><p> LambertW/man/W.Rd: <code><a href="../../lamW/help/lamW.html">lambert_Wm1_C</a></code> in
the <span class="pkg">lamW</span> package.
</p>
</li>
<li><p> LambertW/man/W.Rd: <code><a href="../../lamW/help/lamW.html">lambertW0_C</a></code> and
</p>
</li>
<li><p> LambertW/man/W.Rd: <code><a href="../../lamW/help/lamW.html">lambertWm1_C</a></code> in
the <span class="pkg">lamW</span> package;
</p>
</li></ul>

<p>A fix that should work under both current and proposed schemes is to
change <code>\link[lamW:lamW]{lambertW0_C}</code> to the simpler (and more
correct) <code><a href="../../lamW/help/lambertW0.html">\link[lamW]{lambertW0}</a></code>,
etc. (<code>lambertW0_C</code> is an internal function, not supposed to be
user-callable, and not documented in <code>lamW.Rd</code>). Unfortunately,
this will no longer work for static pages in the current scheme, but
that is hopefully a minor consideration.
</p>


<h3><span class="pkg">parsnip</span></h3>

<p>The only problematic link here is topic <code>fit</code> which is documented
in file <code>reexports.Rd</code> (as a rexported generic), while the file
<code>fit.Rd</code> documents the S3 method <code>fit.model_spec</code>. For the
links below that have the form <code>\link[parsnip:fit]{link-text}</code>,  the
intent is almost certainly to link to <code>fit.Rd</code>, as the links
below currently do, but that will change under the proposed scheme.
</p>

<ul>
<li><p> rules/man/C5_rules.Rd:converted to numeric indicator
values. Note that using <code><a href="../../parsnip/help/fit.html">parsnip::fit()</a></code>
will
</p>
</li>
<li><p> rules/man/C5_rules.Rd:
<code><a href="../../parsnip/help/fit.html">parsnip::fit()</a></code>,
<code><a href="../../parsnip/help/fit_xy.html">parsnip::fit_xy()</a></code>, ...
</p>
</li>
<li><p> rules/man/cubist_rules.Rd: Note that using
<code><a href="../../parsnip/help/fit.html">parsnip::fit()</a></code> will
</p>
</li>
<li><p> rules/man/cubist_rules.Rd:
<code><a href="../../parsnip/help/fit.html">parsnip::fit()</a></code>,
<code><a href="../../parsnip/help/fit_xy.html">parsnip::fit_xy()</a></code>, ...
</p>
</li>
<li><p> rules/man/rule_fit.Rd:
<code><a href="../../parsnip/help/fit.html">parsnip::fit()</a></code>,
<code><a href="../../parsnip/help/fit_xy.html">parsnip::fit_xy()</a></code>, ...
</p>
</li>
<li><p> workflows/man/fit-workflow.Rd: using
<code><a href="../../parsnip/help/fit.html">parsnip::fit.model_spec()</a></code>
</p>
</li></ul>

<p>A fix that would work with both current and proposed schemes would be
change to links of the form
<code><a href="../../parsnip/help/fit.model_spec.html">\link[parsnip:fit.model_spec]{link-text}</a></code>.
</p>


<h3><span class="pkg">perm</span></h3>

<p>Here the file <code>perm.Rd</code> documents topics <code>permTS</code>,
<code>permKS</code>, etc., and the topic <code>perm</code> is in file
<code>perm-package.Rd</code>.
</p>

<ul>
<li><p> FHtest/man/FHtesticp.Rd: see details in <a href="../../perm/help/perm.html">perm</a>
</p>
</li>
<li><p> interval/man/ictest.Rd: see details in <code><a href="../../perm/help/perm.html">perm</a></code>
</p>
</li>
<li><p> interval/man/ictest.Rd: see <code><a href="../../perm/help/perm.html">perm</a></code>
</p>
</li></ul>

<p>The links (all <code>\link[perm]{perm}</code>) above currently link to the
file, which is likely as intended. To continue this in a
back-compatible manner, they should be changed to
<code><a href="../../perm/help/permTS.html">\link[perm:permTS]{perm}</a></code>.
</p>


<h3><span class="pkg">spaMM</span></h3>

<p>The file <code>Matern.corr.Rd</code> documents topic <code>MaternCorr</code>,
while the topic <code>Matern.corr</code> is an alias in
<code>spaMM-internal.Rd</code>. The link
</p>

<ul>
<li><p> IsoriX/man/isofit.Rd: <code><a href="../../spaMM/help/Matern.corr.html">Matern.corr</a></code> for information
</p>
</li></ul>

<p>is likely meant to be to the file <code>Matern.corr.Rd</code>, and so should
be changed to
<code><a href="../../spaMM/help/MaternCorr.html">\link[spaMM:MaternCorr]{Matern.corr}</a></code>,
or probably more appropriately and simply, to
<code><a href="../../spaMM/help/MaternCorr.html">\link[spaMM]{MaternCorr}</a></code>.
</p>


<h3>Examples</h3>

<pre>

a &lt;- tools:::CRAN_aliases_db()
fun &lt;- function(e) {
    files &lt;- tools::file_path_sans_ext(names(e))
    topics &lt;- Map(setdiff, e, files)
    intersect(files, unlist(topics))
}
z &lt;- lapply(a, fun)
z &lt;- Filter(length, z)

ambiguousTopics &lt;- function(pkg)
{
    ## filenames which are also topics in a different file
    files &lt;- z[[pkg]]
    ## which file the corresponding topic is in
    otherfiles &lt;- character(length(files))
    for (i in seq_along(files))
    {
        otherfiles[i] &lt;-
            names(which(sapply(a[[pkg]], function(x) files[i] %in% x)))
    }
    ## Is 'otherfile' also a topic somewhere in the package?
    also_topic &lt;- otherfiles %in% unlist(a[[pkg]])
    data.frame(pkg = pkg, file = files, topicfile = otherfiles,
               also_topic = also_topic)
}

options(width = 120)
do.call(rbind, lapply(names(z), ambiguousTopics))

</pre>

<hr /><div style="text-align: center;">[Package <em>topichelp</em> version 0.0-1 <a href="00Index.html">Index</a>]</div>
</body></html>
